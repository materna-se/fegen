<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Backend - FeGen</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../favicon.svg">
        
        
        <link rel="shortcut icon" href="../favicon.png">
        
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        
        <link rel="stylesheet" href="../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../intro.html">Introduction</a></li><li class="chapter-item expanded "><a href="../quickstart/intro.html"><strong aria-hidden="true">1.</strong> Quick Start Guide</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quickstart/setup.html"><strong aria-hidden="true">1.1.</strong> Setup</a></li><li class="chapter-item expanded "><a href="../quickstart/backend.html" class="active"><strong aria-hidden="true">1.2.</strong> Backend</a></li><li class="chapter-item expanded "><a href="../quickstart/frontend.html"><strong aria-hidden="true">1.3.</strong> Frontend</a></li><li class="chapter-item expanded "><a href="../quickstart/further_reading.html"><strong aria-hidden="true">1.4.</strong> Further Reading</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/intro.html"><strong aria-hidden="true">2.</strong> Reference Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/plugin_configuration/intro.html"><strong aria-hidden="true">2.1.</strong> Plugin Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/plugin_configuration/gradle.html"><strong aria-hidden="true">2.1.1.</strong> Gradle</a></li><li class="chapter-item expanded "><a href="../reference/plugin_configuration/maven.html"><strong aria-hidden="true">2.1.2.</strong> Maven</a></li><li class="chapter-item expanded "><a href="../reference/plugin_configuration/configuration_options.html"><strong aria-hidden="true">2.1.3.</strong> Configuration Options</a></li><li class="chapter-item expanded "><a href="../reference/plugin_configuration/backend.html"><strong aria-hidden="true">2.1.4.</strong> Backend Configuration</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/data_model/intro.html"><strong aria-hidden="true">2.2.</strong> Data Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/data_model/entities.html"><strong aria-hidden="true">2.2.1.</strong> Entities</a></li><li class="chapter-item expanded "><a href="../reference/data_model/relationships.html"><strong aria-hidden="true">2.2.2.</strong> Relationships</a></li><li class="chapter-item expanded "><a href="../reference/data_model/custom_endpoints.html"><strong aria-hidden="true">2.2.3.</strong> Custom Endpoints</a></li><li class="chapter-item expanded "><a href="../reference/data_model/embeddables.html"><strong aria-hidden="true">2.2.4.</strong> Embeddables</a></li><li class="chapter-item expanded "><a href="../reference/data_model/fegen_ignore.html"><strong aria-hidden="true">2.2.5.</strong> @FegenIgnore</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/retrieving/intro.html"><strong aria-hidden="true">2.3.</strong> Retrieving Data</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/retrieving/paging_sorting.html"><strong aria-hidden="true">2.3.1.</strong> Paging and Sorting</a></li><li class="chapter-item expanded "><a href="../reference/retrieving/projections.html"><strong aria-hidden="true">2.3.2.</strong> Projections</a></li><li class="chapter-item expanded "><a href="../reference/retrieving/repository_searches.html"><strong aria-hidden="true">2.3.3.</strong> Repository Searches</a></li><li class="chapter-item expanded "><a href="../reference/retrieving/custom_searches.html"><strong aria-hidden="true">2.3.4.</strong> Custom Searches</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/targets/intro.html"><strong aria-hidden="true">2.4.</strong> Targets</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../reference/targets/typescript.html"><strong aria-hidden="true">2.4.1.</strong> Typescript</a></li><li class="chapter-item expanded "><a href="../reference/targets/kotlin.html"><strong aria-hidden="true">2.4.2.</strong> Kotlin</a></li></ol></li><li class="chapter-item expanded "><a href="../reference/security.html"><strong aria-hidden="true">2.5.</strong> Security</a></li><li class="chapter-item expanded "><a href="../reference/pitfalls.html"><strong aria-hidden="true">2.6.</strong> Pitfalls</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">FeGen</h1>

                    <div class="right-buttons">
                        
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="adding-an-entity-to-the-backend"><a class="header" href="#adding-an-entity-to-the-backend">Adding an Entity to the Backend</a></h1>
<p>In this step you will add an entity for a todo item to your backend.
This will enable you to store todo items in the database and also provide the frontend with a REST API to access and modify todo items.
With FeGen you will also be able to generate client code for your frontend to easily use that REST API.</p>
<h2 id="creating-the-entity-class"><a class="header" href="#creating-the-entity-class">Creating the entity class</a></h2>
<p>Create a java class next to the <code>BackendApplication</code>, so in the <code>backend/src/main/java/com/example/backend</code> directory and name it <code>TodoItem</code>.
Add the <code>@Entity</code> annotation to it to tell Spring and FeGen that instances of this class can be saved to the database.
Create a public field named <code>id</code> of type <code>long</code> within the class and annotate it with <code>@Id</code> and <code>@GeneratedValue</code>.
This ID will be used by FeGen to refer to specific instances of the <code>TodoItem</code> when changing or deleting them and it will be automatically assigned to an entity when it is created.
Also add a <code>String</code> field named <code>text</code> to the class that will contain the description of the todo item and a <code>boolean</code> field <code>done</code>.</p>
<p>Your class should now look like this:</p>
<pre><code class="language-java">package com.example.backend;

import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class TodoItem {

    @Id
    @GeneratedValue
    public long id;

    public String text;
    
    public boolean done;
}
</code></pre>
<h2 id="nullability"><a class="header" href="#nullability">Nullability</a></h2>
<p>If you execute <code>./gradlew fegenWeb</code> now, you will get the following error message and code generation will fail:</p>
<pre><code>[FeGen EntityMgr] Field &quot;text&quot; in entity &quot;com.example.backend.TodoItem&quot; is implicitly nullable.
[FeGen EntityMgr]     Please add a @Nullable annotation if this is intentional
[FeGen EntityMgr]     or add a @NotNull annotation to forbid null values
[FeGen EntityMgr]     Set implicitNullable to WARN to continue the build despite missing @Nullable annotations
</code></pre>
<blockquote>
<p>This is due to the different handling of nullability in Spring and Java versus the target languages of FeGen (Kotlin and Typescript).</p>
<p>In Java, <code>null</code> is a valid value for every non-primitive type.
There are no compile time checks whether a value may be null, so you may e.g. just access fields of a variable and if that variable actually contains null at runtime, this would just cause a <code>NullPointerException</code>.</p>
<p>On the other hand, in Kotlin and Typescript nullability is a property of the type that is in both cases declared with a <code>?</code>.
An object's field may either be nullable, in which case the compiler forces you to handle the case that it contains <code>null</code>, or it may not be nullable, in which case it may never be set it to <code>null</code>.</p>
</blockquote>
<p>Since the code generated by FeGen will be in Typescript, FeGen needs to know whether the fields of your entity may be null or not.
If they are not annotated, Spring will automatically assume that they are nullable.
FeGen could just go with that and give the fields the nullable type in the generated code, but since Typescript will by default enforce handling the null case, it is easier to work with a not nullable typed field if you know that its content may never be null.</p>
<p>In our case, <code>text</code> is the essential field that an item on a todo list is composed of, so annotate it with <code>@Column(nullable = false)</code>.</p>
<blockquote>
<p>Of course, FeGen also accepts <code>@Column(nullable = true)</code>, since you just have to explicitly state that you want your field to be nullable.
Instead of <code>@Column</code>, you may also use <code>@NotNull</code> or <code>@Nullable</code> in case you are using Spring validation anyway.
You do not need to specify nullability for primitive values, as they cannot be null even in Java (this is the case for the <code>done</code> field).
By default, the build process will stop if you have not declared nullability for an entity's field.
Although not recommended, you can configure FeGen to continue the build or even not show a warning at all.
Refer to the <a href="../reference/plugin_configuration/configuration_options.html">Configuration Options</a> page to see how this can be done.</p>
</blockquote>
<h2 id="base-projections"><a class="header" href="#base-projections">Base Projections</a></h2>
<p>If you execute <code>./gradlew fegenWeb</code> now, you will still see a warning by FeGen:</p>
<pre><code>[FeGen ProjectionMgr] The following entities do not have a base projection:
[FeGen ProjectionMgr] TodoItem
</code></pre>
<p>Base projections are needed for technical reasons.
They are interfaces that should be nested into the entity class that they belong to.
In our case, it would look like this:</p>
<pre><code class="language-java">@Entity
public class TodoItem {
    // ...
    
    @Projection(name = &quot;baseProjection&quot;, types = {TodoItem.class})
    interface BaseProjection {
        long getId();
        String getText();
        boolean isDone();
    }
}
</code></pre>
<p>They need to meet the following criteria to be accepted by FeGen:</p>
<ul>
<li>Have a <code>@Projection</code> annotation with <code>&quot;baseProjection&quot;</code> as <code>name</code> and the corresponding entity class as only item in <code>types</code></li>
<li>Have a method defined for each property of the corresponding entity whose type is not an entity or projection
<ul>
<li>The return type of the method must match the type of the corresponding property</li>
<li>The name of the method must be the name of the getter of the property, even if no getter exists on the entity</li>
</ul>
</li>
</ul>
<blockquote>
<p>This guide does not handle using other entities or projections as entities' fields as mentioned in the second bullet point.
To learn about it, go to the <a href="../reference/data_model/relationships.html">Relationships</a> page of the reference documentation</p>
</blockquote>
<p>Your complete entity should look like this now and FeGen should not complain about it anymore:</p>
<pre><code class="language-java">package com.example.backend;

import org.springframework.data.rest.core.config.Projection;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;

@Entity
public class TodoItem {

    @Id
    @GeneratedValue
    public long id;

    @Column(nullable = false)
    public String text;

    public boolean done;

    @Projection(name = &quot;baseProjection&quot;, types = {TodoItem.class})
    interface BaseProjection {
        long getId();
        String getText();
        boolean isDone();
    }
}
</code></pre>
<h2 id="repository"><a class="header" href="#repository">Repository</a></h2>
<p>Although FeGen is happy with your entity, it still won't generate any code to access it.
That is because you have not yet defined a repository for it, so Spring will not offer you any way to interact with your entity from your frontend.
To change that, create an interface in the same directory as your <code>TodoItem</code> entity, name it <code>TodoItemRepository</code> and have it extend <code>JpaRepository&lt;TodoItem, Long&gt;</code>:</p>
<pre><code class="language-java">package com.example.backend;

import org.springframework.data.jpa.repository.JpaRepository;

public interface TodoItemRepository extends JpaRepository&lt;TodoItem, Long&gt; {}
</code></pre>
<p>Now FeGen will output the Typescript code necessary to access your <code>TodoItem</code> entity.</p>
<h2 id="cors"><a class="header" href="#cors">CORS</a></h2>
<p>In this guide, your backend will run on port <code>8080</code>, since this is spring's default port, and your frontend will use port <code>5000</code> which is the default port of the Rollup development server.
Without any further configuration, your browser will prevent your frontend from accessing the backend's API, because it will enforce the rules for Cross Origin Resource Sharing.
You will have to configure your backend to explicitly allow access from your frontend.
Create a class named <code>Config</code>, place it in the same directory as the other classes you created and enter the following content:</p>
<pre><code class="language-java">package com.example.backend;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.rest.core.config.RepositoryRestConfiguration;
import org.springframework.data.rest.webmvc.config.RepositoryRestConfigurer;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class Config {

    @Bean
    public WebMvcConfigurer webMvcConfigurer() {
        return new WebMvcConfigurer() {
            @Override
            public void addCorsMappings(CorsRegistry registry) {
                configureCors(registry);
            }
        };
    }

    @Bean
    public RepositoryRestConfigurer repositoryRestConfigurer() {
        return new RepositoryRestConfigurer() {
            @Override
            public void configureRepositoryRestConfiguration(RepositoryRestConfiguration config, CorsRegistry cors) {
                configureCors(cors);
            }
        };
    }

    private void configureCors(CorsRegistry registry) {
        registry.addMapping(&quot;/**&quot;)
                .allowedOrigins(&quot;http://localhost:5000&quot;)
                .allowedMethods(&quot;GET&quot;, &quot;POST&quot;, &quot;PUT&quot;, &quot;DELETE&quot;);
    }
}
</code></pre>
<p>The two methods returning Configurers will ensure that each response to a request from your frontend will include an HTTP header that declares that this access is allowed.
The second method is important for us as it includes that header when calling repository endpoints to access entities.
The first method is not strictly necessary right now, but will add the header if you create and use custom endpoints.</p>
<p>This is all you have to do for the backend.
Go to the next page to learn how to use the code generated by FeGen in the frontend to finish your web app.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../quickstart/setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../quickstart/frontend.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../quickstart/setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../quickstart/frontend.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        
        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            var socket = new WebSocket("ws://localhost:3000/__livereload");
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>
        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
